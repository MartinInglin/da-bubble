<!-- Main content of the document -->
<main id="mainContent">
  <!-- Header section with channel name and contact information -->

  <div class="height-65vh" *ngIf="channelSelected">

    <header >
      <div (click)="openChannelInfoDialog(selectedChannel.id)" class="channelName">
        {{ selectedChannel.name }}
      </div>
      <div  class="channelMembers" *ngIf="channelSelected">
        <!-- Profile pictures of channel members which are part of the group -->
        <ng-container *ngFor="let user of selectedChannel.users">
          <img src="{{ user.avatar }}" alt="" />
        </ng-container>
      </div>
    </header>

    <!-- Message Content  -->
   
    <div class="message-content" >
      @if (selectedChannel.posts.length === 0) {


      <!-- Date line for messages -->
      <div class="dateLine" *ngFor="let post of selectedChannel.posts; let i = index">
        <div class="Line">
          <span>{{ formatDate(post.timestamp) }}</span>
        </div>
      </div>
      <!--  -->
      <div class="message" *ngFor="let post of selectedChannel.posts; let i = index">
        <div class="message-container" (click)="openThread()">
          <!-- Profile picture of the message author -->
          <img src="{{ post.avatar }}" alt="" />
          <!-- Message box -->
          <div class="message-box">
            <div class="message-name">
              <!-- Name of the message author -->
              <span>{{ post.name }}</span>
            </div>
            <div class="message-text">
              <!-- Text of the message -->
                <span>{{ post.message }}</span>
            </div>

            <div class="message-details">
              <!-- Message actions and time details -->
              <a routerLink="/landingPage" (click)="threadsService.createThread(selectedChannel, 0)">Antworten</a>
              <span>Letzte Antwort:{{
                formatDateTime(selectedChannel.posts[0].timestamp)
                }}
              </span>
            </div>
          </div>
        </div>
      </div>

    }

    <div class="placeholderContainer" *ngIf="channelSelected">
      <img src="{{selectedChannel.name}}" alt="">
      <h3>{{selectedChannel.description}}</h3>
      <div>
        <span>Schreib etwas in die Gruppe <a href=""> {{selectedChannel.name}}</a> damit andere darauf reagieren.</span>
      </div>
    </div>
  </div>

    <!-- Input Feld am unteren Rand des Containers -->
    <div class="inputContent" *ngIf="channelSelected">
      <div class="textArea">

        <textarea name="" id="message-textarea" placeholder="Nachricht an #Entwicklerteam"
          [(ngModel)]="message"></textarea>

        <div class="icons">
          <div class="buttons">
            <a class="addIcon" (click)="openFileDialog()">
              <img src="./../../../../assets/images/icons/add_icon.svg" alt="" />
            </a>
            <input type="file" #fileInput style="display: none" (change)="onFileSelected($event)" />

            <div class="seperator"></div>

            <!-- Liste f端r Emojis -->
            <div class="link-emojis">
              <button mat-button [matMenuTriggerFor]="aboveMenu">
                <img src="./../../../../assets/images/icons/smiley-Icon.svg" alt="" />
              </button>
              <mat-menu #aboveMenu="matMenu" yPosition="above">
                <div class="emoji-container">
                  <span *ngFor="let emoji of emojis" class="emoji" mat-menu-item>{{ emoji }}</span>
                </div>
              </mat-menu>
              <!-- Liste f端r Verlinkungen von Kontakten -->
              <button mat-button [matMenuTriggerFor]="contactLinks">
                <img src="./../../../../assets/images/icons/link_icon.svg" alt="" />
              </button>
              <mat-menu #contactLinks="matMenu" yPosition="above">
                <div class="link-container">
                  <table class="links">
                    <tr *ngFor="let user of allUsers">
                      <td (click)="linkContactInMessage(user.name)">
                        <img [src]="user.avatar" alt="Profilbild" />
                        <span>{{ user.name }}</span>
                      </td>
                    </tr>
                  </table>
                </div>
              </mat-menu>
            </div>
          </div>

          <a (click)="savePost()">
            <img src="./../../../../assets/images/icons/send_icon.svg" alt="" />
          </a>
        </div>
      </div>
    </div>

   



  </div>


  <div class="height-65vh" *ngIf="chatSelected">


    <!-- Header section with channel name and contact information -->
    <header *ngIf="chatSelected">
      <div class="channelName" *ngIf="
        directMessage && directMessage.users && directMessage.users.length > 0
      ">
        <div class="avatarName">
          <img src="{{directMessage.users[0].avatar}}" alt="">
          {{ directMessage.users[0].name }}
        </div>
      </div>
    </header>




    <!-- Message Content  -->

    <div class="message-content">
      <!-- Date line for messages -->
      @if (directMessage && directMessage.posts && directMessage.posts.length > 0 && directMessage.users.length > 0) {
      <div class="dateLine">
        <div class="Line">
          <span>{{ formatDate(selectedChannel.posts[0].timestamp) }}</span>
        </div>
      </div>
      <!--  -->
      <div class="message">
        <div class="message-container">
          <!-- Profile picture of the message author -->
          <img *ngIf="directMessage?.users?.[0]?.avatar" [src]="directMessage.users[0].avatar" alt="" />
          <!-- Message box -->
          <div class="message-box">
            <div class="message-name">
              <!-- Name of the message author -->
              <span>{{directMessage.users[0].name}}</span>
            </div>
            <div class="message-text" *ngIf="directMessage.posts">
              <!-- Text of the message -->
              <span>{{directMessage.posts}}</span>

            </div>

            <div class="message-details">
              <!-- Message actions and time details -->
              <a routerLink="/landingPage" (click)="threadsService.createThread(selectedChannel, 0)">Antworten</a>
              <span>Letzte Antwort:{{ formatDateTime(selectedChannel.posts[0].timestamp) }} </span>
            </div>
          </div>
        </div>
      </div>
      <!-- Message Content  -->
      <div class="message-content" *ngIf="chatSelected">
        <!-- Date line for messages -->
        <div class="dateLine">
          <div class="Line">
            <span>{{ formatDate(selectedChannel.posts[0].timestamp) }}</span>
          </div>
        </div>
        <!--  -->
        <div class="message">
          <div class="message-container" *ngIf="
            directMessage && directMessage.users && directMessage.users.length > 0
          ">
            <!-- Profile picture of the message author -->
            <img *ngIf="directMessage?.users?.[0]?.avatar" [src]="directMessage.users[0].avatar" alt="" />
            <!-- Message box -->
            <div class="message-box">
              <div class="message-name">
                <!-- Name of the message author -->
                <span>{{ directMessage.users[0].name }}</span>
              </div>
              <div class="message-text">
                <!-- Text of the message -->
                <span>{{ directMessage.posts }}</span>
              </div>

              <div class="message-details">
                <!-- Message actions and time details -->
                <a routerLink="/landingPage" (click)="threadsService.createThread(selectedChannel, 0)">Antworten</a>
                <span>Letzte Antwort:{{
                  formatDateTime(selectedChannel.posts[0].timestamp)
                  }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>



      }


      <div class="placeholderContainer" *ngIf="chatSelected && directMessage && directMessage.posts.length === 0">
        <div class="messageAvatarName">
          <img src="{{directMessage.users[0].avatar}}" alt="">
          <span>{{directMessage.users[0].name}}</span>
        </div>

        <div>
          <p>Diese Unterhaltun findet nur zwischen {{directMessage.users[0].name}} und dir statt.</p>
        </div>
      </div>

    </div>

  </div>





  <!-- Input Feld am unteren rand des Containers -->
  <div class="inputContent" id="inputDirectMessage" *ngIf="chatSelected">
    <div class="textArea">
      <textarea name="" id="message-textarea" placeholder="Nachricht an #Entwicklerteam"
        [(ngModel)]="message"></textarea>

      <div class="icons">
        <div class="buttons">
          <a [matMenuTriggerFor]="attachment" class="addIcon">
            <img src="./../../../../assets/images/icons/add_icon.svg" alt="" />
          </a>
          <mat-menu #attachment="matMenu" yPosition="above">
            <div class="attachment-container"></div>
          </mat-menu>

          <div class="seperator"></div>

          <!-- Liste f端r Emojis -->
          <div class="link-emojis">
            <button mat-button [matMenuTriggerFor]="aboveMenu">
              <img src="./../../../../assets/images/icons/smiley-Icon.svg" alt="" />
            </button>
            <mat-menu #aboveMenu="matMenu" yPosition="above">
              <div class="emoji-container">
                <span *ngFor="let emoji of emojis" class="emoji" mat-menu-item>{{ emoji }}</span>
              </div>
            </mat-menu>
            <!-- Liste f端r Verlinkungen von Kontakten -->
            <button mat-button [matMenuTriggerFor]="contactLinks">
              <img src="./../../../../assets/images/icons/link_icon.svg" alt="" />
            </button>
            <mat-menu #contactLinks="matMenu" yPosition="above">
              <div class="link-container">
                <table class="links">
                  <tr *ngFor="let user of allUsers">
                    <td (click)="linkContactInMessage(user.name)">
                      <img [src]="user.avatar" alt="Profilbild" />
                      <span>{{ user.name }}</span>
                    </td>
                  </tr>
                </table>
              </div>
            </mat-menu>
          </div>
        </div>

        <a>
          <img src="./../../../../assets/images/icons/send_icon.svg" alt="" />
        </a>
      </div>
    </div>
  </div>

</main>